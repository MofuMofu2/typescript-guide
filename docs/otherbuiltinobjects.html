

<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>その他の組み込み型 &mdash; 仕事ですぐに使えるTypeScript  ドキュメント</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="クラス" href="class.html" />
    <link rel="prev" title="関数" href="function.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> 仕事ですぐに使えるTypeScript
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">TypeScriptの世界を知る</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="preface.html">前書き</a></li>
<li class="toctree-l1"><a class="reference internal" href="ecosystem.html">Node.jsエコシステムを体験しよう</a></li>
</ul>
<p class="caption"><span class="caption-text">TypeScriptの書き方</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="variable.html">変数</a></li>
<li class="toctree-l1"><a class="reference internal" href="primitive.html">プリミティブ型</a></li>
<li class="toctree-l1"><a class="reference internal" href="complex.html">複合型</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax.html">基本的な構文</a></li>
<li class="toctree-l1"><a class="reference internal" href="typing.html">基本的な型付け</a></li>
<li class="toctree-l1"><a class="reference internal" href="function.html">関数</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">その他の組み込み型</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#json"><code class="docutils literal notranslate"><span class="pre">JSON</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">JSONのパース</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#syntaxerror"><code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>例外</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">JSONとコメント</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id4">文字列化</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">インデント</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">JSONとデータロス</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#date"><code class="docutils literal notranslate"><span class="pre">Date</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id8">現在時刻の取得・エポック時刻</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">特定の日時の<code class="docutils literal notranslate"><span class="pre">Date</span></code>インスタンスの作成</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">日付のフォーマット出力</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">日付データの交換</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#typescript-javascript">TypeScript（含むJavaScript同士）</a></li>
<li class="toctree-l4"><a class="reference internal" href="#go">Goとの交換の場合</a></li>
<li class="toctree-l4"><a class="reference internal" href="#python">Pythonとの交換の場合</a></li>
<li class="toctree-l4"><a class="reference internal" href="#java-8">Javaとの交換の場合(8以降)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="class.html">クラス</a></li>
<li class="toctree-l1"><a class="reference internal" href="async.html">非同期処理</a></li>
<li class="toctree-l1"><a class="reference internal" href="exception.html">例外処理</a></li>
<li class="toctree-l1"><a class="reference internal" href="module.html">モジュール</a></li>
<li class="toctree-l1"><a class="reference internal" href="console.html"><code class="docutils literal notranslate"><span class="pre">console.log</span></code>によるログ出力</a></li>
</ul>
<p class="caption"><span class="caption-text">中級のテクニック</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="generics.html">ジェネリクス</a></li>
<li class="toctree-l1"><a class="reference internal" href="functional.html">関数型指向のプログラミング</a></li>
<li class="toctree-l1"><a class="reference internal" href="class2.html">クラス上級編</a></li>
<li class="toctree-l1"><a class="reference internal" href="reactive.html">リアクティブ</a></li>
<li class="toctree-l1"><a class="reference internal" href="advance.html">高度なテクニック</a></li>
</ul>
<p class="caption"><span class="caption-text">環境ごとのTips</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="prodenv.html">ソフトウェア開発の環境を考える</a></li>
<li class="toctree-l1"><a class="reference internal" href="baseenv.html">基本の環境構築</a></li>
<li class="toctree-l1"><a class="reference internal" href="libenv.html">ライブラリ開発のための環境設定</a></li>
<li class="toctree-l1"><a class="reference internal" href="clienv.html">CLIツール・ウェブサーバー作成のための環境設定</a></li>
<li class="toctree-l1"><a class="reference internal" href="react.html">Reactの環境構築</a></li>
<li class="toctree-l1"><a class="reference internal" href="vue.html">Vue.jsの環境構築</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci.html">CI（継続的インテグレーション）環境の構築</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">成果物のデプロイ</a></li>
<li class="toctree-l1"><a class="reference internal" href="version.html">使用ライブラリのバージョン管理</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="recommended.html">おすすめのパッケージ・ツール</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributors.html">貢献者</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">仕事ですぐに使えるTypeScript</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>その他の組み込み型</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/otherbuiltinobjects.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>その他の組み込み型<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>これまでの説明の中で、いくつかのデータの種類（ここでは誤解をおそれず、大雑把にクラスとしておきます）について説明してきました。</p>
<ul class="simple">
<li><p>プリミティブ型</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">boolean</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">number</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">string</span></code>と正規表現</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>と<code class="docutils literal notranslate"><span class="pre">null</span></code></p></li>
</ul>
</li>
<li><p>複合型</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Array</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Object</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Map</span></code>と<code class="docutils literal notranslate"><span class="pre">WeakMap</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Set</span></code>と<code class="docutils literal notranslate"><span class="pre">WeakSet</span></code></p></li>
</ul>
</li>
<li><p>関数</p></li>
</ul>
<p>TypeScriptとJavaScriptはブラウザの中の言語として作られたため、数多くのブラウザ環境専用のクラスを備えていますが、それ以外にも言語の組み込みのクラスがいくつかありますので、本章ではそれらについて説明していきます。なお、<code class="docutils literal notranslate"><span class="pre">Error</span></code>クラスについては<a class="reference internal" href="exception.html"><span class="doc">例外処理</span></a>で触れます。</p>
<div class="section" id="json">
<h2><code class="docutils literal notranslate"><span class="pre">JSON</span></code><a class="headerlink" href="#json" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>JavaScriptで外部のAPIのやりとりなどで一番使うのはこのJSONでしょう。サーバーから帰ってくるJSON形式の文字列を、プログラム中で扱いやすいJavaScriptやTypeScriptのプリミティブなデータ型などに変換します。</p>
<p>基本は<code class="docutils literal notranslate"><span class="pre">parse()</span></code>と<code class="docutils literal notranslate"><span class="pre">stringify()</span></code>を呼ぶだけですので使い方に迷うことはないでしょう。</p>
<div class="section" id="id2">
<h3>JSONのパース<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span>// aはany型
const a = JSON.parse(‘{&quot;name&quot;: &quot;John Cleese&quot;}`);

// asで型情報を付与できる。
const p = JSON.parse(‘{&quot;name&quot;: &quot;Terry Gilliam&quot;}`) as Person;
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">parse()</span></code>は<code class="docutils literal notranslate"><span class="pre">any</span></code>型になります。<code class="docutils literal notranslate"><span class="pre">as</span></code>で何かしらの型にキャストする必要がありますが、このパースは当然実行時に行われます。<code class="docutils literal notranslate"><span class="pre">as</span></code>はコンパイル時の型チェックのためのものなので、実際に実行時にどのような型が来るかは推測でしかありません。このJSONのパース周りは、コンパイルは通ったのに、想定した型と違う情報がきたためにエラーになる、ということが一番起きやすいポイントです。<code class="docutils literal notranslate"><span class="pre">as</span></code>は一見その型と同等であると保証しているように見せてしまいますが、要素の有無のチェックなどは動的な言語を扱っている意識を忘れないで行いましょう。</p>
<p>型定義をする必要がないかと言えば、明らかなスペルチェックは見つけられますし、補完もされるので、可能なら定義しておく方が良いでしょう。</p>
<div class="section" id="syntaxerror">
<h4><code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>例外<a class="headerlink" href="#syntaxerror" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>この関数は、JSONの文法違反があると<code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>例外を投げます。TypeScriptで例外を扱うことは稀ですが、キャッチしないと何か操作したのに処理が行われていないように見えるなどの不具合になります。大々的にエラーダイアログが出たりはしないので気付きにくかったりしますが、コンソールには出力されていたりします。パースするときには<code class="docutils literal notranslate"><span class="pre">try</span></code>でくくって、エラーが出たときにはダミーの値を入れるなり、自分でエラーダイアログを表示するなり、対処しましょう。</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">person</span>: <span class="kt">Person</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nx">person</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span>: <span class="kt">unknown</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// fallback</span>
    <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Eric Idle&quot;</span> <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>この関数は<code class="docutils literal notranslate"><span class="pre">fetch()</span></code>の中でも使われています。例外の発生についてもまったく同じです。</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;/api/person&quot;</span><span class="p">);</span>
<span class="c1">// 本当はres.okで通信が成功したかチェックが必要！</span>
<span class="nx">person</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Michael Palin&quot;</span> <span class="p">};</span>
</pre></div>
</div>
<p>HTTPのAPIの場合、エラーがあると、<code class="docutils literal notranslate"><span class="pre">Forbidden</span></code>などのステータスコードの文字列がレスポンスとして帰ってくることがあり、これをJSONにパースしようとすると次のような例外が発生します。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Uncaught SyntaxError: Unexpected token F in JSON at position 0
</pre></div>
</div>
<p>ほとんどの場合はステータスコードのチェックで防げますが、try文を使うとさらに安心です。</p>
</div>
<div class="section" id="id3">
<h4>JSONとコメント<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>JSONの厳格な文法（<a class="reference external" href="https://json.org">json.org</a>）にはコメントはありません。しかし、入れたくなることがあります。</p>
<p>TypeScriptの設定ファイルの<code class="docutils literal notranslate"><span class="pre">tsconfig.json</span></code>や、VSCodeの設定ファイルなどはコメントが入れられます。前者はTypeScriptパーサーを流用したパーサーを使っていますので、TypeScriptと同じコメントが利用できます。後者はJSON with Comments(.jsonc)というモードを持っています。標準の<code class="docutils literal notranslate"><span class="pre">JSON.parse()</span></code>は仕様に従っているのでコメントがあるとエラーになります。次のようなライブラリを使う必要があるでしょう。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.npmjs.com/package/strip-json-comments">strip-json-comments</a></p></li>
</ul>
<p>設定ファイルとして使って読み手が自分自身だけならいいのですが、サーバーなどとのデータ交換用にJSONを使う場合、読み手がコメントを無視して読んでくれないかぎりはコメントを使うべきではありません。その他の方法としては、JSON Schemaの仕様にある<code class="docutils literal notranslate"><span class="pre">$comment</span></code>キーを使うという妥協案もあります。</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;$comment&quot;</span><span class="p">:</span> <span class="s2">&quot;コメントです&quot;</span><span class="p">,</span>
   <span class="nt">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;鳥貴族&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id4">
<h3>文字列化<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>文字列化はJavaScriptのオブジェクト、配列、数値、文字列、boolean型などの値を渡すと、それを安全に伝送できる文字列にしてくれます。</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">JSON形式に文字列化</span><a class="headerlink" href="#id16" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="c1">// bは文字列</span>
<span class="kr">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">person</span><span class="o">:</span> <span class="s2">&quot;Graham Chapman&quot;</span><span class="p">)</span>
<span class="c1">// &#39;{&quot;person&quot;:&quot;Graham Chapman&quot;}&#39;</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">stringify()</span></code>には2つ追加の引数があります。1つは置換関数、もう1つはインデントです。</p>
<p>このうち置換関数は<code class="docutils literal notranslate"><span class="pre">function(key:</span> <span class="pre">any,</span> <span class="pre">value:</span> <span class="pre">any):</span> <span class="pre">any</span></code>な関数で、キーと値を見て、実際に出力する値を決めますが、あまり使い勝手の良いものではありません。階層があったり、配列で同型のオブジェクトがあったりして、仮に同名のキーがあっても、渡される情報だけではどちらの値か区別できなかったりします。<code class="docutils literal notranslate"><span class="pre">bigint</span></code>などの変換できない型の場合はreplacerが実行される前にエラーになってしまうため、この関数で出力できるように文字列にするといった使い方もできません。事前に出力可能なオブジェクト・配列・プリミティブだけのきれいな情報に変換しておくべきです。そのため、忘れてしまっても構いません。</p>
<div class="section" id="id5">
<h4>インデント<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>デフォルトではインデントがなく、文字数最小で出力されます。インデントに数値、あるいは<code class="docutils literal notranslate"><span class="pre">&quot;</span>&#160;&#160;&#160; <span class="pre">&quot;</span></code>といった文字列を渡すことでインデントが行われて見やすくなります。ただし、Node.jsやブラウザの<code class="docutils literal notranslate"><span class="pre">console.log()</span></code>の場合はインデントを設定しなくても見やすく表示してくれるため、整形してファイル出力したい場合以外は使う必要はないと思います。</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">インデント</span><a class="headerlink" href="#id17" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">montyPython</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">members</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;John Cleese&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Terry Gilliam&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Eric Idle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Michael Palin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Graham Chapman&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Terry Jones&quot;</span>
    <span class="p">],</span>
<span class="p">};</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">montyPython</span><span class="p">));</span>
<span class="c1">// {&quot;members&quot;:[&quot;John Cleese&quot;,&quot;Terry Gilliam&quot;,&quot;Eric Idle&quot;,&quot;Michael Palin&quot;,&quot;Graham Chapman&quot;,&quot;Terry Jones&quot;]}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">montyPython</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="c1">// {</span>
<span class="c1">//   &quot;members&quot;: [</span>
<span class="c1">//     &quot;John Cleese&quot;,</span>
<span class="c1">//     &quot;Terry Gilliam&quot;,</span>
<span class="c1">//     &quot;Eric Idle&quot;,</span>
<span class="c1">//     &quot;Michael Palin&quot;,</span>
<span class="c1">//     &quot;Graham Chapman&quot;,</span>
<span class="c1">//     &quot;Terry Jones&quot;</span>
<span class="c1">//   ]</span>
<span class="c1">// }</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h4>JSONとデータロス<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>JSONは言語をまたいで使われるデータのシリアライズのための仕組みです。元はJavaScriptのオブジェクト表現をフォーマットにしたものではありますが（JSONは作成されたのではなく、発見されたと言われています）、いくつかTypeScriptと違うところもあります。</p>
<p>JSONは単純な木構造であり、TypeScriptのメモリ上の表現のすべてを表現できるわけではありません。例えば、親が子を、子が親を参照しているような循環構造の場合、うまく文字列化できず、エラーになります。事前に変換する関数を使って、子から親方向の参照を切った新しいオブジェクト階層を作るなどして単方向の参照になるようにします。</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">循環参照があるとTypeError</span><a class="headerlink" href="#id18" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Terry Jones&quot;</span><span class="p">};</span>
<span class="kr">const</span> <span class="nx">group</span> <span class="o">=</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Pythons&quot;</span><span class="p">,</span> <span class="nx">member</span><span class="o">:</span> <span class="p">[</span><span class="nx">person</span><span class="p">]};</span>
<span class="nx">person</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="nx">group</span><span class="p">;</span> <span class="c1">// お互いに参照しあっているため、循環参照になる</span>

<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">group</span><span class="p">)</span>
<span class="c1">// Uncaught TypeError: Converting circular structure to JSON</span>
</pre></div>
</div>
</div>
<p>また、JSONが扱えるデータ型はそれほど多くありません。ネイティブで扱える型は以下の6つです。他のものはうまく文字列にならなかったり、なったとしても再度パースしたときにもとの型が復元できないことがあります。</p>
<ul class="simple">
<li><p>オブジェクト</p></li>
<li><p>配列</p></li>
<li><p>文字列</p></li>
<li><p>数値</p></li>
<li><p>boolean型</p></li>
<li><p>null</p></li>
</ul>
<p>例えば<code class="docutils literal notranslate"><span class="pre">undefined</span></code>の場合はそのキーがなかったことになります。クラスの場合はメンバーフィールドのみのオブジェクトになります。一応データとしては復元できますが、戻すときには単なるオブジェクトで、クラスのインスタンスではなくなります。各クラスに、オブジェクトからインスタンスを復元するファクトリーメソッドを用意してあげる必要があるでしょう。日付は文字列になります。これも、事前に<code class="docutils literal notranslate"><span class="pre">valueOf()</span></code>で数値化しても良いでしょう。<code class="docutils literal notranslate"><span class="pre">Map()</span></code>などは値が完全に失われたインスタンスになるため、注意が必要です。</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">クラス、日付</span><a class="headerlink" href="#id19" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="kr">class</span> <span class="nx">C</span> <span class="p">{</span> <span class="kr">constructor</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
<span class="o">&gt;</span> <span class="kr">const</span> <span class="nx">i</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">C</span><span class="p">();</span>
<span class="o">&gt;</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
<span class="c1">// &#39;{&quot;a&quot;:1,&quot;b&quot;:&quot;hello&quot;}&#39;</span>

<span class="o">&gt;</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">())</span>
<span class="c1">// &#39;&quot;2020-09-15T14:41:37.173Z&quot;&#39;</span>

<span class="o">&gt;</span> <span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">]])</span>
<span class="c1">// Map(3) { 1 =&gt; 2, 2 =&gt; 4, 3 =&gt; 8 }</span>
<span class="o">&gt;</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
<span class="c1">// &#39;{}&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="date">
<h2><code class="docutils literal notranslate"><span class="pre">Date</span></code><a class="headerlink" href="#date" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>日付と時間を扱うのが<code class="docutils literal notranslate"><span class="pre">Date</span></code>型です。これは最初期から実装されている型で、TypeScriptやJavaScriptで日付を扱う場合、まず出てくるのがこれです。ただし、即席で作られたこともあって評判がよくなく、大切な機能がいくつか抜け落ちていたり、文字列のパースが柔軟性がなかったりするため、いくつもの追加のモジュールなどが作られています。</p>
<p>以前は <a class="reference external" href="https://momentjs.com">moment.js</a> が長い間広く使われてきましたが、現在は<a class="reference external" href="https://momentjs.com/docs/#/-project-status/">積極的な開発を中止する声明を出しています</a>。そのmoment.jsの声明の中で推奨されているのが次のライブラリです。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://moment.github.io/luxon/">Luxon</a> (型定義は別に <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span> <span class="pre">&#64;types/luxon</span></code> が必要)</p></li>
<li><p><a class="reference external" href="https://day.js.org/">Day.js</a> (TypeScript型定義同梱)</p></li>
<li><p><a class="reference external" href="https://date-fns.org/">date-funs</a> (TypeScript型定義同梱)</p></li>
<li><p><a class="reference external" href="https://js-joda.github.io/js-joda/">js-Joda</a> (TypeScript型定義同梱)</p></li>
</ul>
<p>より便利なフォーマットやパース、日時演算などはこちらのパッケージを利用すると簡単に行えます。</p>
<p>JavaScript本体においても、<code class="docutils literal notranslate"><span class="pre">Date</span></code>を置き換える<code class="docutils literal notranslate"><span class="pre">Temporal</span></code>が提案されています。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/tc39/proposal-temporal">https://github.com/tc39/proposal-temporal</a></p></li>
</ul>
<p>将来的に、ここの説明は<code class="docutils literal notranslate"><span class="pre">Temporal</span></code>ベースで書き換えられると思いますが、ひとまずここでは<code class="docutils literal notranslate"><span class="pre">Date</span></code>のよくある使い方について紹介していきます。</p>
<p>TypeScriptの<code class="docutils literal notranslate"><span class="pre">Date</span></code>型は数字に毛の生えたようなものですので、それを前提にみていくと良いと思います。</p>
<div class="section" id="id8">
<h3>現在時刻の取得・エポック時刻<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Date()</span></code>で簡単に作成できます。コンピュータに保存されているタイムゾーンの情報も含んだ、<code class="docutils literal notranslate"><span class="pre">Date</span></code>のインスタンスが作成できます。</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="c1">// 現在時刻でDateのインスタンス作成</span>
<span class="kr">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
<span class="c1">// newを付けないと文字列として帰ってくる</span>
<span class="kr">const</span> <span class="nx">nowStr</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">();</span>
<span class="c1">// &#39;Sun Sep 06 2020 22:36:08 GMT+0900 (Japan Standard Time)&#39;</span>
</pre></div>
</div>
<p>コンピュータの世界ではUNIX時刻、あるいはUNIX秒、エポック（Epoch）秒、エポック時刻と呼ばれるものがよく使われます。これは1970年1月1日（UTC基準）からの経過時間で時間を表すものです。JavaScriptの中ではミリ秒単位であって秒ではないため、本章ではエポック時刻という名前で統一します。</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="c1">// ミリ秒単位のエポック時刻取得</span>
<span class="kr">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">console.time()</span></code>と<code class="docutils literal notranslate"><span class="pre">console.timeEnd()</span></code>でも時間計測ができますが、何かしらの処理の間の時間を撮りたい場合には、<code class="docutils literal notranslate"><span class="pre">Date.now()</span></code>を複数回呼び出すことで、ミリ秒単位で時間が計測できます。ブラウザでは<code class="docutils literal notranslate"><span class="pre">performance.now()</span></code>という高精度タイマーがありましたが、セキュリティの懸念もあって現在は精度が落とされていますので、<code class="docutils literal notranslate"><span class="pre">Date.now()</span></code>とあまり差はないでしょう。</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="c1">//  :</span>
<span class="c1">// 時間のかかる処理</span>
<span class="c1">//  :</span>
<span class="kr">const</span> <span class="nx">duration</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">;</span>
<span class="c1">// 経過時間（ミリ秒）の取得</span>
</pre></div>
</div>
<p>このエポック時刻から<code class="docutils literal notranslate"><span class="pre">Date</span></code>のインスタンスにする場合は<code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Date()</span></code>の引数にミリ秒単位の時間を入れます。逆に、<code class="docutils literal notranslate"><span class="pre">Date()</span></code>のインスタンスからエポック時刻を取得するには<code class="docutils literal notranslate"><span class="pre">valueOf()</span></code>メソッドを使います。</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="c1">// 現在の時刻から100秒（10万ミリ秒）前の時刻の取得</span>
<span class="kr">const</span> <span class="nx">hundredSecAgo</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>

<span class="c1">// エポック時刻取得</span>
<span class="kr">const</span> <span class="nx">epoch</span> <span class="o">=</span> <span class="nx">hundredSecAgo</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">();</span>
</pre></div>
</div>
<p>さまざまな時間の情報がありますが、TypeScriptではどれを基準に扱うべきでしょうか？ブラウザはユーザーインタフェースであるため、ユーザーの利用環境のタイムゾーン情報を持っています。しかし、多くのユーザーの情報を同時に扱うサーバーではタイムゾーン情報も含めて扱うのは手間隙がかかります。データベースエンジンによってはタイムゾーン込みの時刻も扱いやすいものもあったりはしますが、シンプルに扱うためには以下の指針で大部分のシステムはまかなえるでしょう。</p>
<ul class="simple">
<li><p>クライアントで時刻を取得してサーバーに送信するときは、<code class="docutils literal notranslate"><span class="pre">Date().now</span></code>などでエポック時刻にしてからサーバーに送信する（タイムゾーン情報なし）</p></li>
<li><p>サーバーでは常にエポック時刻で扱う（ただし、言語によっては秒単位だったり、ミリ秒単位だったり、マイクロ秒単位だったり違いはあるため、そこはルールを決めておきましょう）</p></li>
<li><p>サーバーからフロントに送った段階で<code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Date()</span></code>などを使って、ローカル時刻化する</p></li>
</ul>
</div>
<div class="section" id="id9">
<h3>特定の日時の<code class="docutils literal notranslate"><span class="pre">Date</span></code>インスタンスの作成<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>特定の日時インスタンスを作成するには、<code class="docutils literal notranslate"><span class="pre">Date()</span></code>コンストラクタの引数に数値を設定して作成します。月の数値が1少なく評価される（1月は0）な点に注意が必要です。この日時は現在のタイムゾーンで評価されます。</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="c1">// 2020年9月21日21時10分5秒</span>
<span class="c1">// 日本で実行すると日本時間21時（UTCでは9時間前の12時）に</span>
<span class="kr">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>UTCの時刻から生成したい場合には、<code class="docutils literal notranslate"><span class="pre">Date.UTC()</span></code>関数を使います。これはエポック秒を返すのでこれを<code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Date()</span></code>に渡すことで、UTC指定の時刻のインスタンスが作成できます。</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="c1">// UTCの2020年9月21日11時10分5秒</span>
<span class="c1">// 日本で実行すると日本時間20時（日本時間はUTCは9時間進んでいるように見える）に</span>
<span class="kr">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">UTC</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>日付のフォーマット出力<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc3393.html"><strong>RFC 3393</strong></a>形式にするには、<code class="docutils literal notranslate"><span class="pre">toISOString()</span></code>メソッドを使います。<code class="docutils literal notranslate"><span class="pre">toString()</span></code>だとECMAScriptの仕様書で定められたロケール情報も含む文字列で出力を行ます。後者の場合、ミリ秒単位のデータは丸められてしまいます。</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
<span class="nx">now</span><span class="p">.</span><span class="nx">toISOString</span><span class="p">()</span>
<span class="c1">// &#39;2020-09-21T12:38:15.655Z&#39;</span>

<span class="nx">now</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
<span class="c1">// &#39;Mon Sep 21 2020 21:38:15 GMT+0900 (Japan Standard Time)&#39;</span>
</pre></div>
</div>
<p>短い形式やオリジナルの形式にするには自分でコードを書く必要があります。短く日時を表現しようとする場合のコードは次のようになります。月のみカレンダーの表記と異なって、0が1月になる点に注意してください。</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">str</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span>
    <span class="nx">now</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span>
<span class="si">}</span><span class="sb">/</span><span class="si">${</span>
    <span class="nb">String</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
<span class="si">}</span><span class="sb">/</span><span class="si">${</span>
    <span class="nb">String</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()).</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
<span class="si">}</span><span class="sb"> </span><span class="si">${</span>
    <span class="nb">String</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()).</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
<span class="si">}</span><span class="sb">:</span><span class="si">${</span>
    <span class="nb">String</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">()).</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
<span class="si">}</span><span class="sb">:</span><span class="si">${</span>
    <span class="nb">String</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">()).</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
<span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="c1">// &quot;2020/09/06 13:55:43&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">padStart()</span></code>と、テンプレート文字列のおかげで、以前よりははるかに書きやすくなりましたが、Day.jsなどの提供するフォーマット関数を使った方が短く可読性も高くなるでしょう。</p>
</div>
<div class="section" id="id11">
<h3>日付データの交換<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>クライアントとサーバーの間ではJSONなどを通じてデータをやりとりします。JSONでデータを転送するときは数値か文字列で表現する必要があります。日付データは既に説明した通りに、ミリ秒か秒のどちらかの数値で交換するのがもっともコード的には少ない配慮で実現できます。しかし、一方で出力された数字の列を見ても、即座に現在の日時を暗算できる人はいないでしょう。可読性という点では文字列を使いたいこともあるでしょう。本節ではデータをやりとりする相手ごとのデータ変換の仕方について詳しく説明していきます。</p>
<div class="section" id="typescript-javascript">
<h4>TypeScript（含むJavaScript同士）<a class="headerlink" href="#typescript-javascript" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>TypeScript（含むJavaScript）であれば、<code class="docutils literal notranslate"><span class="pre">toISOString()</span></code>でも、<code class="docutils literal notranslate"><span class="pre">toString()</span></code>でも、どちらの方式で出力した文字列であってもパースできます。<code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Date()</span></code>に渡すと<code class="docutils literal notranslate"><span class="pre">Date</span></code>のインスタンスが、<code class="docutils literal notranslate"><span class="pre">Date.parse()</span></code>に渡すと、エポック時刻が帰ってきます。</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">fromToISOString</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="sb">`2020-09-21T12:38:15.655Z`</span><span class="p">)</span>
<span class="c1">// 2020-09-21T12:38:15.655Z</span>

<span class="kr">const</span> <span class="nx">fromToString</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="sb">`Mon Sep 21 2020 21:38:15 GMT+0900 (Japan Standard Time)`</span><span class="p">)</span>
<span class="c1">// 2020-09-21T12:38:15.000Z</span>

<span class="kr">const</span> <span class="nx">fromToISOStringEpoch</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="sb">`2020-09-21T12:38:15.655Z`</span><span class="p">)</span>
<span class="c1">// 1600691895655</span>

<span class="kr">const</span> <span class="nx">fromToStringEpoch</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="sb">`Mon Sep 21 2020 21:38:15 GMT+0900 (Japan Standard Time)`</span><span class="p">)</span>
<span class="c1">// 1600691895000</span>
</pre></div>
</div>
</div>
<div class="section" id="go">
<h4>Goとの交換の場合<a class="headerlink" href="#go" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>Goでは日付のフォーマットが何種類か選べますが、このうち、タイムゾーンの時差が数値で入っているフォーマットはTypeScriptでパース可能です。ナノ秒の情報がミリ秒に丸められてしまいますが、一番精度良く伝達できるのは<code class="docutils literal notranslate"><span class="pre">time.RFC3339Nano</span></code>の出力です。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">time.RubyDate</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time.RFC822Z</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time.RFC1123Z</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time.RFC3339</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time.RFC3339Nano</span></code></p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">GoでRFC3339Nanoで出力</span><a class="headerlink" href="#id20" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">now</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">Format</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">RFC3339Nano</span><span class="p">))</span>
    <span class="c1">// 2020-09-21T21:35:45.057076+09:00</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">TypeScriptでパース</span><a class="headerlink" href="#id21" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">receivedFromGo</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="sb">`2020-09-21T21:35:45.057076+09:00`</span><span class="p">)</span>
<span class="c1">// 2020-09-21T12:35:45.057Z</span>
</pre></div>
</div>
</div>
<p>他の言語に出力する場合、<code class="docutils literal notranslate"><span class="pre">toISOString()</span></code>が無難でしょう。Goは<code class="docutils literal notranslate"><span class="pre">time.RFC3339</span></code>か、<code class="docutils literal notranslate"><span class="pre">time.RFC3339Nano</span></code>を使ってパースできます。結果はどちらも同じです。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">RFC3339</span><span class="p">,</span> <span class="s">&quot;2020-09-21T12:38:15.655Z&quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
    <span class="c1">// 2020-09-21 12:38:15.655 +0000 UTC</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="python">
<h4>Pythonとの交換の場合<a class="headerlink" href="#python" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>Pythonで出力する場合は<code class="docutils literal notranslate"><span class="pre">datetime.datetime.isoformat()</span></code>メソッドを使うと良いでしょう。このメソッドはタイムゾーン情報を取り払い、現在のタイムゾーンの表記そのものをフォーマットして出力します。TypeScriptの<code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Date()</span></code>はUTCであることを前提としてパースするため、出力時はUTCとして出すように心がける必要があります。このUTCで出力された文字列はTypeScriptでパースできます。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="c1"># localの場合はastimezone()を呼んでUTCに</span>
<span class="n">localtime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">utctime</span> <span class="o">=</span> <span class="n">localtime</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
<span class="n">utctime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<span class="c1"># 2020-09-21T13:42:58.279772+00:00</span>

<span class="c1"># あるいは、最初からUTCで扱う</span>
<span class="n">utctime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
<span class="n">utctime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<span class="c1"># 2020-09-21T13:42:58.279772+00:00</span>
</pre></div>
</div>
<p>パースはやっかいです。Stack Overflowでスレッドが立つぐらいのネタです<a class="footnote-reference brackets" href="#id13" id="id12">1</a>。Python 3.7からは<code class="docutils literal notranslate"><span class="pre">fromisoformat()</span></code>というクラスメソッドが増えましたが、以前からの<code class="docutils literal notranslate"><span class="pre">datetime.strptime()</span></code>にフォーマット指定を与えた方が高速とのことです。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;2020-09-21T12:38:15.655Z&#39;</span>

<span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
<span class="c1"># datetime.datetime(2020, 9, 21, 12, 38, 15, 655000, tzinfo=datetime.timezone.utc)</span>

<span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">%z&#39;</span><span class="p">)</span>
<span class="c1"># datetime.datetime(2020, 9, 21, 12, 38, 15, 655000, tzinfo=datetime.timezone.utc)</span>
</pre></div>
</div>
<p>いっそのこと、エポック時刻で扱う方法の方がシンプルでしょう。TypeScriptはミリ秒単位で、Pythonは秒単位なので、1000で割ってから渡す必要があるのと、UTCの数値であることを明示する必要があります。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="mi">1600691895655</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
<span class="c1"># datetime.datetime(2020, 9, 21, 12, 38, 15, 655000, tzinfo=datetime.timezone.utc)</span>
</pre></div>
</div>
<dl class="footnote brackets">
<dt class="label" id="id13"><span class="brackets"><a class="fn-backref" href="#id12">1</a></span></dt>
<dd><p><a class="reference external" href="https://stackoverflow.com/questions/127803/how-do-i-parse-an-iso-8601-formatted-date">https://stackoverflow.com/questions/127803/how-do-i-parse-an-iso-8601-formatted-date</a></p>
</dd>
</dl>
</div>
<div class="section" id="java-8">
<h4>Javaとの交換の場合(8以降)<a class="headerlink" href="#java-8" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>Java8から標準になったクラス群<a class="footnote-reference brackets" href="#id15" id="id14">2</a>を使ってTypeScriptとの交換を行ってみます。ここで紹介するコードはJava8以降で動作するはずです。このサンプルはJava 11で検証しています。</p>
<p><code class="docutils literal notranslate"><span class="pre">Date.toISOString()</span></code>と同等の出力は<code class="docutils literal notranslate"><span class="pre">DateTimeFormatter</span></code>で作成できます。UTCのゾーンになるようにインスタンスを作成してから<code class="docutils literal notranslate"><span class="pre">format()</span></code>メソッドを使って変換します。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.time.Instant</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.time.ZonedDateTime</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.time.ZoneId</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.time.format.DateTimeFormatter</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ParseTest</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[</span> <span class="o">]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="n">RFC3339_FORMAT</span> <span class="o">=</span> <span class="n">DateTimeFormatter</span><span class="p">.</span><span class="na">ofPattern</span><span class="p">(</span><span class="s">&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSS&#39;Z&#39;&quot;</span><span class="p">);</span>

        <span class="kd">var</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>
        <span class="kd">var</span> <span class="n">isoString</span> <span class="o">=</span> <span class="n">l</span><span class="p">.</span><span class="na">withZoneSameInstant</span><span class="p">(</span><span class="n">ZoneOffset</span><span class="p">.</span><span class="na">UTC</span><span class="p">).</span><span class="na">format</span><span class="p">(</span><span class="n">RFC3339_FORMAT</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">isoString</span><span class="p">);</span>
        <span class="c1">// &quot;2020-09-23T13:55:53.780Z&quot;</span>
     <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>この文字列はTypeScriptでパースできます。</p>
<p>TypeScriptで生成した文字列のパースには前述の<code class="docutils literal notranslate"><span class="pre">DateTimeFormatter</span></code>も使えますが、それ以外には<code class="docutils literal notranslate"><span class="pre">java.time.Instant</span></code>が使えます。これはある時点での時刻を表すクラスです。TypeScriptの<code class="docutils literal notranslate"><span class="pre">Date.toISOString()</span></code>の出力する文字列をパースできます。実際に日時の操作を行う<code class="docutils literal notranslate"><span class="pre">LocalDateTime</span></code>や<code class="docutils literal notranslate"><span class="pre">ZonedDateTime</span></code>へも、ここから変換できます。次のサンプルは<code class="docutils literal notranslate"><span class="pre">Instant</span></code>でパースし、<code class="docutils literal notranslate"><span class="pre">ZonedDateTime</span></code>に変換しています。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.time.Instant</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.time.ZonedDateTime</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.time.ZoneId</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.time.format.DateTimeFormatter</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ParseTest</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[</span> <span class="o">]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Instant</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2020-09-23T14:06:11.027Z&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">ofInstant</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ZoneId</span><span class="p">.</span><span class="na">systemDefault</span><span class="p">());</span>

        <span class="kd">var</span> <span class="n">f</span> <span class="o">=</span> <span class="n">DateTimeFormatter</span><span class="p">.</span><span class="na">ofPattern</span><span class="p">(</span><span class="s">&quot;yyyy/MM/dd HH:mm:ss&quot;</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">f</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="footnote brackets">
<dt class="label" id="id15"><span class="brackets"><a class="fn-backref" href="#id14">2</a></span></dt>
<dd><p><a class="reference external" href="https://qiita.com/tag1216/items/91a471b33f383981bfaa">Java8の日時APIはとりあえずこれだけ覚えとけ</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="class.html" class="btn btn-neutral float-right" title="クラス" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="function.html" class="btn btn-neutral float-left" title="関数" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 著作権 2019-2020, Future Corporation

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>