

<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CLIツール・ウェブサーバー作成のための環境設定 &mdash; 仕事ですぐに使えるTypeScript  ドキュメント</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="CI（継続的インテグレーション）環境の構築" href="ci.html" />
    <link rel="prev" title="ライブラリ開発のための環境設定" href="libenv.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> 仕事ですぐに使えるTypeScript
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">TypeScriptの世界を知る</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="preface.html">前書き</a></li>
<li class="toctree-l1"><a class="reference internal" href="ecosystem.html">Node.jsエコシステムを体験しよう</a></li>
</ul>
<p class="caption"><span class="caption-text">TypeScriptの書き方</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="variable.html">変数</a></li>
<li class="toctree-l1"><a class="reference internal" href="primitive.html">プリミティブ型</a></li>
<li class="toctree-l1"><a class="reference internal" href="complex.html">複合型</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax.html">基本的な構文</a></li>
<li class="toctree-l1"><a class="reference internal" href="typing.html">基本的な型付け</a></li>
<li class="toctree-l1"><a class="reference internal" href="function.html">関数</a></li>
<li class="toctree-l1"><a class="reference internal" href="otherbuiltinobjects.html">その他の組み込み型・関数</a></li>
<li class="toctree-l1"><a class="reference internal" href="class.html">クラス</a></li>
<li class="toctree-l1"><a class="reference internal" href="async.html">非同期処理</a></li>
<li class="toctree-l1"><a class="reference internal" href="exception.html">例外処理</a></li>
<li class="toctree-l1"><a class="reference internal" href="module.html">モジュール</a></li>
<li class="toctree-l1"><a class="reference internal" href="console.html"><code class="docutils literal notranslate"><span class="pre">console.log</span></code>によるログ出力</a></li>
</ul>
<p class="caption"><span class="caption-text">中級のテクニック</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="generics.html">ジェネリクス</a></li>
<li class="toctree-l1"><a class="reference internal" href="functional.html">関数型指向のプログラミング</a></li>
<li class="toctree-l1"><a class="reference internal" href="class2.html">クラス上級編</a></li>
<li class="toctree-l1"><a class="reference internal" href="reactive.html">リアクティブ</a></li>
<li class="toctree-l1"><a class="reference internal" href="advance.html">高度なテクニック</a></li>
</ul>
<p class="caption"><span class="caption-text">環境ごとのTips（共通環境・ブラウザ以外）</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="prodenv.html">ソフトウェア開発の環境を考える</a></li>
<li class="toctree-l1"><a class="reference internal" href="baseenv.html">基本の環境構築</a></li>
<li class="toctree-l1"><a class="reference internal" href="libenv.html">ライブラリ開発のための環境設定</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">CLIツール・ウェブサーバー作成のための環境設定</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#node-js">Node.jsの環境構築</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">作業フォルダを作る</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">ビルド設定</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">CLIツールのソースコード</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Node.jsのまとめ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deno">Deno</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ci.html">CI（継続的インテグレーション）環境の構築</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">成果物のデプロイ</a></li>
<li class="toctree-l1"><a class="reference internal" href="version.html">使用ライブラリのバージョン管理</a></li>
</ul>
<p class="caption"><span class="caption-text">環境ごとのTips（ブラウザ環境）</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="browserenv.html">ブラウザ環境</a></li>
<li class="toctree-l1"><a class="reference internal" href="browserobjects.html">ブラウザ関連の組み込み型</a></li>
<li class="toctree-l1"><a class="reference internal" href="react.html">Reactの環境構築</a></li>
<li class="toctree-l1"><a class="reference internal" href="vue.html">Vue.jsの環境構築</a></li>
<li class="toctree-l1"><a class="reference internal" href="webparcel.html">Parcelを使ったウェブ開発</a></li>
<li class="toctree-l1"><a class="reference internal" href="electron.html">Electronアプリケーションの作成</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="recommended.html">おすすめのパッケージ・ツール</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributors.html">貢献者</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">仕事ですぐに使えるTypeScript</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>CLIツール・ウェブサーバー作成のための環境設定</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/clienv.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cli">
<h1>CLIツール・ウェブサーバー作成のための環境設定<a class="headerlink" href="#cli" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>TypeScriptを使ってCLIツールやウェブサーバーなどのNode.jsやDenoがある環境で動作するソフトウェアを作成するための環境構築方法を紹介していきます。2つ方法があります。</p>
<ul class="simple">
<li><p>Node.jsがインストールされている環境向け</p></li>
<li><p>Denoががインストールされている環境向け</p></li>
</ul>
<p>どちらも、TypeScriptをJavaScript変換して1ファイルにまとめたファイルを作成します。</p>
<div class="section" id="node-js">
<h2>Node.jsの環境構築<a class="headerlink" href="#node-js" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Node.js向けには&#64;zeit/nccを利用します。</p>
<p>&#64;zeit/nccはTypeScriptに最初から対応したコンパイラで、コマンドラインツールやウェブサーバーなどのNode.jsアプリケーションを1ファイルにするために作られています。&#64;zeit/ncc自体も自分自身を使ってバンドル化されており、ごく小さいサイズですばやくインストールできます。Goを参考にしており、<code class="docutils literal notranslate"><span class="pre">tsconfig.json</span></code>以外の設定は不要です。</p>
<p>他に実績のあるツールとしてはBrowserifyがあります。これも、tsifyというプラグインと併用することでTypeScript製アプリケーションをバンドルして1ファイルにできます。このツールは、Node.js製アプリケーションをブラウザでも動くようにすることをメインの目的として作られました。後発の&#64;zeit/nccに比べると設定が多いのと、TypeScriptの設定を変えてcommon.js形式のパッケージにしないと扱えないのがnccと比べると煩雑です。また、<code class="docutils literal notranslate"><span class="pre">tsc</span></code>を使いバンドルせずにTypeScriptをJavaScriptに変換するだけを行って配布する方法もありますが、バンドルをしないとさまざまなファイルが入ってくるため、配布サイズも大きくなりがちです。</p>
<div class="section" id="id1">
<h3>作業フォルダを作る<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>フォルダを作成し、JavaScriptのいつものプロジェクトのように<code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">init</span> <span class="pre">-y</span></code>を実行して<code class="docutils literal notranslate"><span class="pre">package.json</span></code>を作成しましょう。</p>
<p>ライブラリの時は、ES2015 modulesとCommonJSの2通り準備しましたが、CLIの場合はNode.jsだけ動かせば良いので、出力先は一つになります。コンパイルしたファイル置き場は<code class="docutils literal notranslate"><span class="pre">dist</span></code>フォルダになりますが、コンパイル時に自動で作られるので作成しておく必要はありませんが、<code class="docutils literal notranslate"><span class="pre">.gitignore</span></code>には登録しておきましょう。</p>
</div>
<div class="section" id="id2">
<h3>ビルド設定<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>まずは&#64;zeit/nccをインストールします。</p>
<p>Node.jsの機能を使うことになるため、Node.jsのAPIの型定義ファイルは入れておきましょう。TypeScriptはnccにバンドルされていますが、バンドルされている処理系のバージョンが古いことがあります。インストールしてあるTypeScriptを優先的に使ってくれるので入れておくと良いでしょう。</p>
<p>コマンドラインで良く使うであろうライブラリを追加しておきます。
カラーでのコンソール出力、コマンドライン引数のパーサ、ヘルプメッセージ表示です。</p>
<p>どれもTypeScriptの型定義があるので、これも落としておきます。
また、ソースマップサポートを入れると、エラーの行番号がソースのTypeScriptの行番号で表示されるようになって便利なので、これも入れておきます。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ npm install --save-dev @zeit/ncc typescript

$ npm install --save-dev @types/node @types/cli-color
   @types/command-line-args @types/command-line-usage
   @types/source-map-support

$ npm install --save cli-color command-line-args
   command-line-usage source-map-support
</pre></div>
</div>
<p>TypeScriptのビルド設定のポイントは、ブラウザからは使わないので、ターゲットのバージョンを高くできる点にあります。
ローカルでは安定版を使ったとしてもNode.js 10が使えるでしょう。</p>
<p>ライブラリのときとは異なり、成果物を利用するのはNode.jsの処理系だけなので、.d.tsファイルを生成する必要はありません。</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">tsconfig.json</span><a class="headerlink" href="#id7" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;es2018&quot;,        // お好みで変更
    &quot;declaration&quot;: false,      // 生成したものを他から使うことはないのでfalseに
    &quot;declarationMap&quot;: false,   // 同上
    &quot;sourceMap&quot;: true,         //
    &quot;strict&quot;: true,
    &quot;noUnusedLocals&quot;: true,
    &quot;noUnusedParameters&quot;: true,
    &quot;noImplicitReturns&quot;: true,
    &quot;noFallthroughCasesInSwitch&quot;: true,
    &quot;esModuleInterop&quot;: true,
    &quot;experimentalDecorators&quot;: true,
    &quot;emitDecoratorMetadata&quot;: true,
    &quot;module&quot;: &quot;commonjs&quot;,      // Node.jsで使うため
    &quot;outDir&quot;: &quot;./dist&quot;         // 出力先を設定
  },
  &quot;include&quot;: [&quot;src/**/*&quot;]
}
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">package.json</span></code> 設定時は、他のパッケージから利用されることはないため、 <code class="docutils literal notranslate"><span class="pre">main</span></code>/<code class="docutils literal notranslate"><span class="pre">modules</span></code>/<code class="docutils literal notranslate"><span class="pre">types</span></code> の項目は不要です。
代わりに、 <code class="docutils literal notranslate"><span class="pre">bin</span></code> 項目でエントリーポイント（ビルド結果の方）のファイルを指定します。
このキー名が実行ファイル名になります。</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">package.js</span><a class="headerlink" href="#id8" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
  &quot;bin&quot;: {
    &quot;awesome-cmd&quot;: &quot;dist/index.js&quot;
  },
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;ncc build main.ts --minify --v8-cache --source-map&quot;,
    ”watch&quot;: &quot;ncc build main.ts --watch&quot;,
    &quot;start&quot;: &quot;ncc run main.ts&quot;,
    &quot;lint&quot;: &quot;eslint .&quot;,
    &quot;fix&quot;: &quot;eslint --fix .&quot;
  }
}
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ncc</span> <span class="pre">build</span></code>でビルドします。<code class="docutils literal notranslate"><span class="pre">ncc</span> <span class="pre">run</span></code>でビルドして即座に実行します。設定ファイルはありません。必要十分な機能が揃っています。オプションで指定できるものは以下の通りです。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--minify</span></code>: ミニファイしてファイルを小さくする</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--source-map</span></code>: ソースマップを出力</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-e,</span> <span class="pre">--external</span> <span class="pre">[mod]</span></code>: バンドルをスキップするモジュール</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--watch</span></code>: 変更を検知してビルド</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--v8-cache</span></code>: V8のコンパイルキャッシュを生成</p></li>
</ul>
<p>テストの設定、VSCodeの設定は他の環境の設定と変わりません。</p>
<p>もし、バイナリを入れる必要のあるライブラリがあると、ビルド時にエラーになります。その場合は、そのパッケージを <code class="docutils literal notranslate"><span class="pre">--external</span> <span class="pre">パッケージ名</span></code> で指定してバンドルされないようにします。
ただし、この場合は配布環境でこのライブラリだけはnpm installしなければなりません。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><strong>Node.js/Deno以外の処理系</strong></p>
<p>また、low.js <a class="footnote-reference brackets" href="#id4" id="id3">1</a> という、ES5しか動かないもののNode.jsと一部互換性があるモジュールを提供し、ファイルサイズがごく小さいインタプリタがありますが、これと一緒に使うこともできます。</p>
<p>low.jsはES5までしか対応しないため、出力ターゲットをES5にする必要があります。</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">tsconfig.json (low.jsを使う場合)</span><a class="headerlink" href="#id9" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;es5&quot;,             // もしlow.jsを使うなら
    &quot;lib&quot;: [&quot;dom&quot;, &quot;es2017&quot;]     // もしlow.jsで新しいクラスなどを使うなら
  }
}
</pre></div>
</div>
</div>
<p>これで、TypeScript製かつ、必要なライブラリが全部バンドルされたシングルファイルなスクリプトができあがります。</p>
</div>
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id3">1</a></span></dt>
<dd><p><a class="reference external" href="https://www.lowjs.org/">https://www.lowjs.org/</a></p>
</dd>
</dl>
</div>
<div class="section" id="id5">
<h3>CLIツールのソースコード<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>TypeScriptはシェバング(#!)があると特別扱いしてくれます。
必ず入れておきましょう。
ここで紹介したcommand-line-argsとcommand-line-usageはWikiで用例などが定義されているので、実装イメージに近いものをベースに加工していけば良いでしょう。</p>
<div class="highlight-ts notranslate"><div class="highlight"><pre><span></span>index.ts
#!/usr/bin/env node

import * as clc from &quot;cli-color&quot;;
import * as commandLineArgs from &quot;command-line-args&quot;;
import * as commandLineUsage from &quot;command-line-usage&quot;;

// あとで治す
require(&#39;source-map-support&#39;).install();

async function main() {
    // 内部実装
}

main();
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Node.jsのまとめ<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>コマンドラインツールの場合は、npmで配布する場合はライブラリ同様、バンドラーを使わずに、TypeScriptだけを使えば大丈夫です。
ここにある設定で、次のようなことが達成できました。</p>
<ul class="simple">
<li><p>TypeScriptでCLIツールのコードを記述する</p></li>
<li><p>使う人は普段通りnpm installすれば実行形式がインストールされ、特別なツールやライブラリの設定をしなくても利用できる。</p></li>
</ul>
<p>また、おまけで1ファイルにビルドする方法も紹介しました。</p>
<p><code class="docutils literal notranslate"><span class="pre">package.json</span></code> の <code class="docutils literal notranslate"><span class="pre">scripts</span></code> のところに、開発に必要なタスクがコマンドとして定義されています。
npmコマンドを使って行うことができます。すべてライブラリと同じです。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ビルドして実行</span>
$ npm start

<span class="c1"># ビルドしてパッケージを作成</span>
$ npm run build
$ npm pack

<span class="c1"># テスト実行 (VSCodeだと、⌘ R Tでいける）</span>
$ npm <span class="nb">test</span>

<span class="c1"># 文法チェック</span>
$ npm run lint

<span class="c1"># フォーマッター実行</span>
$ npm run fix
</pre></div>
</div>
</div>
</div>
<div class="section" id="deno">
<h2>Deno<a class="headerlink" href="#deno" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Denoは新しい処理系です。Node.jsと同じくV8をベースとしている兄弟処理系ですが、TypeScriptにデフォルトで対応していたり、ネイティブコード部分はRustを使って実装されています。
サードパーティのパッケージはnpmコマンドではなくdenoコマンドを使ってダウンロードします。</p>
<p>Node.jsを置き換えるものかというと、現時点ではまだパッケージやツールが足りていません。特にNode.jsのnpmはウェブフロントエンドのライブラリなどの配布にも使われており、ウェブフロントエンドの開発のためのプラットフォームとしても活用されています。Denoはコマンドラインツールやウェブサービスの開発に特化しています。</p>
<p>こちらもGoを参考にしたコマンドを持っています。それ単体でビルドして配布できます。</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ci.html" class="btn btn-neutral float-right" title="CI（継続的インテグレーション）環境の構築" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="libenv.html" class="btn btn-neutral float-left" title="ライブラリ開発のための環境設定" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 著作権 2019-2020, Future Corporation

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>